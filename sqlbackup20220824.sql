USE spring;

CREATE table example (PRIMARY_KEY int primary key auto_increment, EXAMPLE_STRING varchar(50), EXAMPLE_INT int);

DROP TABLE EXAMPLE;

SELECT * FROM EXAMPLE;

select * from book;

create table Account(EXAMPLE_ID varchar(30) primary key, 
EXAMPLE_PASSWORD varchar(30) not null, 
EXAMPLE_EMAIL varchar(50) not null);
select * from account;

select * from board;
create table board(board_num int primary key auto_increment,
title varchar(50) not null,
writer varchar(50) not null,
content text,
read_count int not null,
write_date datetime not null);

create table member(member_num int primary key auto_increment, 
id varchar(50) unique not null, 
password varchar(100) not null,
email varchar(100),
phone varchar(20));

select * from member;

drop table board;

drop table QUIZ_BOARD;
drop table quiz_correct_count;
drop table member;

SET foreign_key_checks = 0;
SET foreign_key_checks = 1;

CREATE TABLE QUIZ_BOARD (
	QUIZ_NUM INT PRIMARY KEY AUTO_INCREMENT,
	QUIZ_TITLE VARCHAR(100) NOT NULL,
	QUIZ_CONTENTS VARCHAR(500) NOT NULL,
	QUIZ_WRITER VARCHAR(100) NOT NULL,
	QUIZ_WRITE_DATE DATE NOT NULL,
	QUIZ_ANSWER1 VARCHAR(100) NOT NULL,
	QUIZ_ANSWER2 VARCHAR(100) NOT NULL,
	QUIZ_ANSWER3 VARCHAR(100) NOT NULL,
	QUIZ_ANSWER4 VARCHAR(100) NOT NULL,
	QUIZ_TRUE_ANSWER INT NOT NULL,
	QUIZ_VIEW INT NOT NULL DEFAULT 0,
	QUIZ_TYPE VARCHAR(20) NOT NULL
);

CREATE TABLE MEMBER (
	MEMBER_NUM INT PRIMARY KEY AUTO_INCREMENT, 
	MEMBER_ID VARCHAR(30) NOT NULL UNIQUE, 
	MEMBER_PW VARCHAR(30) NOT NULL, 
	MEMBER_EMAIL VARCHAR(50) NOT NULL, 
	MEMBER_PHONE VARCHAR(30) NOT NULL
);

ALTER TABLE QUIZ_BOARD ADD FOREIGN KEY(QUIZ_WRITER) REFERENCES MEMBER(MEMBER_ID);

CREATE TABLE QUIZ_CORRECT_COUNT(
	MEMBER_ID VARCHAR(30) NOT NULL, QUIZ_NUM INT NOT NULL
);

ALTER TABLE QUIZ_CORRECT_COUNT ADD FOREIGN KEY(QUIZ_NUM) REFERENCES QUIZ_BOARD(QUIZ_NUM);
ALTER TABLE QUIZ_CORRECT_COUNT ADD FOREIGN KEY(MEMBER_ID) REFERENCES MEMBER(MEMBER_ID);

insert into MEMBER (MEMBER_ID, MEMBER_PW, MEMBER_EMAIL, MEMBER_PHONE) values ('asdf1', 'asdf', 'asdf@a.com','010-1010-1010');
insert into MEMBER (MEMBER_ID, MEMBER_PW, MEMBER_EMAIL, MEMBER_PHONE) values ('asdf2', 'asdf', 'asdf@a.com','010-1010-1010');

insert into QUIZ_BOARD(QUIZ_TITLE, QUIZ_CONTENTS, QUIZ_WRITER, QUIZ_WRITE_DATE, QUIZ_ANSWER1, QUIZ_ANSWER2, QUIZ_ANSWER3, QUIZ_ANSWER4, QUIZ_TRUE_ANSWER, QUIZ_TYPE)
 VALUES("퀴즈 제목", "퀴즈 내용", "asdf1", now(), "퀴즈 답1","퀴즈 답2","퀴즈 답3","퀴즈 답4", 1, "CSS");
 
 ALTER TABLE QNA convert to charset utf8;
 
insert into QUIZ_CORRECT_COUNT values("asdf1",160);
insert into QUIZ_CORRECT_COUNT values("asdf2",5);

select * from QUIZ_CORRECT_COUNT;
SELECT * FROM QUIZ_BOARD where quiz_num = 160;

SELECT COUNT(MEMBER.MEMBER_CORRECT_QUIZ) AS QUIZ_CORRECT_NUM
		FROM QUIZ_BOARD 
		LEFT JOIN MEMBER ON (QUIZ_BOARD.QUIZ_NUM = MEMBER.MEMBER_CORRECT_QUIZ)
		GROUP BY QUIZ_BOARD.QUIZ_NUM;
        
SELECT QUIZ_BOARD.*, COUNT(MEMBER.MEMBER_CORRECT_QUIZ) AS QUIZ_CORRECT_NUM
		FROM QUIZ_BOARD 
		LEFT JOIN MEMBER ON (QUIZ_BOARD.QUIZ_NUM = MEMBER.MEMBER_CORRECT_QUIZ)
        GROUP BY QUIZ_BOARD.QUIZ_NUM ORDER BY QUIZ_BOARD.QUIZ_NUM DESC LIMIT 1, 3;
SELECT * FROM QUIZ_BOARD ORDER BY QUIZ_NUM DESC LIMIT 3;
select * from MEMBER;

SELECT * FROM QUIZ_BOARD WHERE QUIZ_TYPE = "sql" ORDER BY QUIZ_NUM DESC LIMIT 1, 3;

select * from QUIZ_CORRECT_COUNT;

select * from QUIZ_BOARD;

select QUIZ_TYPE, MEMBER_ID, count(qcc.QUIZ_NUM) as COUNT
from QUIZ_CORRECT_COUNT as qcc left join QUIZ_BOARD qb
on qcc.QUIZ_NUM = qb.QUIZ_NUM
where QUIZ_TYPE = "JAVA"
group by qcc.MEMBER_ID;
commit;

DELETE FROM QUIZ_CORRECT_COUNT WHERE QUIZ_NUM = "78";
UPDATE QUIZ_BOARD SET QUIZ_VIEW = QUIZ_VIEW + 1 WHERE QUIZ_NUM = '1';
DELETE FROM QUIZ_CORRECT_COUNT WHERE MEMBER_ID LIKE "TEST%";